<html>
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" >
<script src="https://code.jquery.com/jquery-1.12.4.min.js" ></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
<style>
body {background: '#bassa55'; font-family: sans-serif;}

p {margin: 1em 0 .5em}

input {
    font-size: 1.2em;
    border-radius: 4px;
    padding: 4px;
}

input[type="submit"]{
    margin-top: .5em
}
table>tr>td{width:80px;}
table>tr>td input{width:40px;}
</style>

<script src="https://code.jquery.com/jquery-2.1.4.js"></script>
  <meta charset="utf-8">
  <title>Dynamic Table</title>
</head>
<body>



<!-------------------------------------------------------------------------------------------------------------------->
 <label>Number of rows to be generated</label>
    <input type="number" id="table-row-num" value="0" oninput="myFunction()">

    <div class="container">
        <div class="row form-group" style="margin-top:30px;">
            <div class="col-lg-6">
                <button class="btn btn-block btn-success btn-insert-data Trigger" id="insert_btn" data-toggle="modal" data-target="#insert_data">INSERT</button>
            </div>
            <div class="col-lg-6">
                <a href="{% url 'home' %}" class="btn btn-block btn-success" role="button" aria-pressed="true">View Table</a>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12">
                  <div class="alert alert-success" id="upt_success" style="display:none">

                  </div>
                   <div class="alert alert-danger" id="upt_error" style="display:none">

                  </div>
            </div>
        </div>
    <div id= "table-gen">
        <form id="form" method="post" action="">
        <table cellpadding="1" cellspacing="1" border="1">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>layer Name</th> 
                        <th>BPL</th>
                        <th>MgO</th>
                        <th>MO</th>
                        <th>SiO2</th>
                        <th>CO2</th>
                        <th>Mix %</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for value in data %}
                    <tr>
                        <td>{{ value.id }}</td>
                        <td class="editable" data-type="name">{{ value.name }}</td>
                        <td class="editable" data-type="BPL">{{ value.BPL }}</td>
                        <td class="editable" data-type="MgO">{{ value.MgO }}</td>
                        <td class="editable" data-type="MO">{{ value.MO }}</td>
                        <td class="editable" data-type="SiO2">{{ value.SiO2 }}</td>
                        <td class="editable" data-type="CO2">{{ value.CO2 }}</td>
                        <td data-type="Mix">{{ value.Mix }}</td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<script>

$(".btn-insert-data").click(function(){
  //  $(".btn-insert-data").attr("disabled","disabled");
  //  $(".btn-insert-data").text("Saving Data....");

    var json_data=[];
    $(".input_data").each(function(){
            var value=$(this).val();
            var parent_html=$(this).parent();
            parent_html.html(value);
            $(this).remove();
     });
    $("tbody tr").each(function(){
         var id=$(this).children().eq(0).text()
         var name=$(this).children().eq(1).text()
         var BPL=$(this).children().eq(2).text()
         var MgO=$(this).children().eq(3).text()
         var MO=$(this).children().eq(4).text()
         var SiO2=$(this).children().eq(5).text()
         var CO2=$(this).children().eq(6).text()
         
         var single_data={"id":id,"name":name,"BPL":BPL,"MgO":MgO,"MO":MO,"SiO2":SiO2,"CO2":CO2};
         json_data.push(single_data);
    });
    var string_data=JSON.stringify(json_data)
    $.ajax({
            url:"{% url 'insert' %}",
            type:'POST',
            data:{data:string_data}
        })
        .done(function(response){
            if(response['error']==false){
                $("#upt_error").hide();
                $("#upt_success").text(response['errorMessage']);
                $("#upt_success").show();

            }
            else{
                $("#upt_success").hide();
                $("#upt_error").text(response['errorMessage']);
                $("#upt_error").show();
            }
        })
        .fail(function(){
             $("#upt_success").hide();
             $("#upt_error").text("Something Went Wrong!");
             $("#upt_error").show();
        })
        
});
$(".btn-simulate-data").click(function(){
  //  $(".btn-insert-data").attr("disabled","disabled");
  //  $(".btn-insert-data").text("Saving Data....");

    var json_data=[];
    $(".input_data").each(function(){
            var value=$(this).val();
            var parent_html=$(this).parent();
            parent_html.html(value);
            $(this).remove();
     });
    $("tbody tr").each(function(){
         var id=$(this).children().eq(0).text()
         var name=$(this).children().eq(1).text()
         var BPL=$(this).children().eq(2).text()
         var MgO=$(this).children().eq(3).text()
         var MO=$(this).children().eq(4).text()
         var SiO2=$(this).children().eq(5).text()
         var CO2=$(this).children().eq(6).text()
         
         var single_data={"id":id,"name":name,"BPL":BPL,"MgO":MgO,"MO":MO,"SiO2":SiO2,"CO2":CO2};
         json_data.push(single_data);
    });
    var string_data=JSON.stringify(json_data)
    $.ajax({
            url:"{% url 'simulate' %}",
            type:'POST',
            data:{data:string_data}
        })
        .done(function(response){
            if(response['error']==false){
                $("#upt_error").hide();
                $("#upt_success").text(response['errorMessage']);
                $("#upt_success").show();

            }
            else{
                $("#upt_success").hide();
                $("#upt_error").text(response['errorMessage']);
                $("#upt_error").show();
            }
        })
        .fail(function(){
             $("#upt_success").hide();
             $("#upt_error").text("Something Went Wrong!");
             $("#upt_error").show();
        })
        
});
</script>